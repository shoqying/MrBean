<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mrbean.mappers.rawMaterialsReceivingMapper">

    <!-- 원자재 입고 정보 매핑 -->
    <resultMap id="RawMaterialsReceivingResultMap" type="com.mrbean.rawmaterialsreceiving.RawMaterialsReceivingVO">
        <id property="rrNo" column="rr_no"/>
        <result property="rmlNo" column="rml_no"/>
        <result property="rmlBno" column="rml_bno"/>
        <result property="rmCode" column="rm_code"/>
        <result property="rrQuantity" column="rr_quantity"/>
        <result property="rrUnit" column="rr_unit"/>
        <result property="rrExpirydate" column="rr_expirydate"/>
    </resultMap>

    <!-- 원자재 입고 정보 등록 -->
    <insert id="createRawMaterial" parameterType="com.mrbean.rawmaterialsreceiving.RawMaterialsReceivingVO">
	    INSERT INTO rawmaterials_receiving 
	    (rr_no, rml_no, rml_bno, rm_code, rr_quantity, rr_unit, rr_expirydate, available_stock)
	    VALUES 
	    (#{rrNo}, #{rmlNo}, #{rmlBno}, #{rmCode}, #{rrQuantity}, #{rrUnit}, 
	     DATE_ADD(NOW(), INTERVAL 6 MONTH), 
	     #{rrQuantity} - COALESCE(#{reservedQuantity}, 0))
	</insert>

    <!-- 원자재 입고 정보 수정 -->
    <update id="updateRawMaterial" parameterType="com.mrbean.rawmaterialsreceiving.RawMaterialsReceivingVO">
        UPDATE rawmaterials_receiving
        SET rml_no = #{rmlNo}, rml_bno = #{rmlBno}, rm_code = #{rmCode}, 
            rr_quantity = #{rrQuantity}, rr_unit = #{rrUnit}, rr_expirydate = #{rrExpirydate}
        WHERE rr_no = #{rrNo}
    </update>

    <!-- 원자재 입고 정보 삭제 -->
    <delete id="deleteRawMaterial" parameterType="java.lang.String">
        DELETE FROM rawmaterials_receiving
        WHERE rr_no = #{rrNo}
    </delete>

    <!-- 원자재 입고 목록 조회 -->
    <select id="getAllRawMaterials" resultMap="RawMaterialsReceivingResultMap">
        SELECT rr_no, rml_no, rml_bno, rm_code, rr_quantity, rr_unit, rr_expirydate
        FROM rawmaterials_receiving
        ORDER BY rr_expirydate DESC
    </select>

</mapper>
